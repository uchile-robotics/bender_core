<?xml version="1.0"?>
<robot name="sensor_asus_xtion_pro" xmlns:xacro="http://ros.org/wiki/xacro">
  
  <xacro:macro name="sensor_asus_dynamixel" params="prefix name parent ns">
    
    <!-- Gazebo Links material -->
    <xacro:gazebo_link link="${prefix}${name}_link" color="Black" />
  
    <!-- Transmissions -->
    <xacro:joint_transmission joint="${name}_joint"/>

    <link name="${prefix}${name}_link">
      <inertial>
        <mass value="0.170" />
        <origin xyz="0.0 0.0 0.0" rpy="0 0 0" />
        <cuboid_inertia_def x="0.05" y="0.2" z="0.05" mass="0.170"/>
      </inertial>
      <visual>
        <origin
          xyz="0 0 0"
          rpy="0 0 0" />
        <geometry>
          <mesh
            filename="package://bender_description/meshes/sensors/asus_dynamixel.stl" />
        </geometry>
        <material
          name="">
          <color
            rgba="0.1 0.1 0.1 1" />
        </material>
      </visual>
      <collision>
        <origin xyz="0.0 0.0 0.0" rpy="0 0 0" />
        <geometry>
          <box size="0.05 0.20 0.05"/>
        </geometry>
      </collision>
    </link>
    <joint name="${name}_joint" type="revolute">
      <origin xyz="0.06 0 0.03" 
              rpy="0 0 0"/>
      <parent link="${parent}"/>
      <child link="${prefix}${name}_link" />
      <axis xyz="0 1 0" />
      <limit 
        effort="1"
        lower="${-60 * M_PI/180}"
        upper="${60 * M_PI/180}"
        velocity="${3 * M_PI/180}"/>
      <dynamics damping="0.1" />
    </joint>
   
    <joint name="${name}_camera_rgb_joint" type="fixed">
      <origin
        xyz="0.021124 0.021 0.044216"
        rpy="0 0 0" />
      <parent link="${prefix}${name}_link"/>
      <child link="${prefix}${name}_rgb_frame"/>
    </joint>
    <link name="${prefix}${name}_rgb_frame"/>
    
    <joint name="${name}_camera_rgb_optical_joint" type="fixed">
      <origin xyz="0 0 0" rpy="${-M_PI/2} 0 ${-M_PI/2}" />
      <parent link="${prefix}${name}_rgb_frame" />
      <child link="${prefix}${name}_rgb_optical_frame" />
    </joint>
    <link name="${prefix}${name}_rgb_optical_frame"/>

    <joint name="${name}_camera_depth_joint" type="fixed">
      <origin xyz="0.021124 0.047 0.044216" rpy="0 0 0" />
      <parent link="${prefix}${name}_link"/>
      <child link="${prefix}${name}_depth_frame" />
    </joint>
    <link name="${prefix}${name}_depth_frame"/>

    <joint name="${name}_camera_depth_optical_joint" type="fixed">
      <origin xyz="0 0 0" rpy="${-M_PI/2} 0 ${-M_PI/2}" />
      <parent link="${prefix}${name}_depth_frame" />
      <child link="${prefix}${name}_depth_optical_frame" />
    </joint>
    <link name="${prefix}${name}_depth_optical_frame"/>

    <!-- Camera depth Gazebo -->
    <xacro:sim_depth_camera name="${name}" frame="${prefix}${name}_depth" ns="${ns}"/>
  
  </xacro:macro>
</robot>
