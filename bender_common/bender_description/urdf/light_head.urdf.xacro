<?xml version="1.0"?>
<robot name="bender_light_head" xmlns:xacro="http://ros.org/wiki/xacro">
  
  <xacro:macro name="light_head" params="parent prefix ns">
    <!-- Gazebo Links material -->
    <xacro:gazebo_link link="${prefix}light_head_base_link" color="Grey" />
    <xacro:gazebo_link link="${prefix}light_head_yaw_link" color="Grey" />
    <xacro:gazebo_link link="${prefix}light_head_pitch_link" color="DarkGrey" />

    <!-- Transmissions -->
    <xacro:joint_transmission joint="light_head_yaw_joint"/>
    <xacro:joint_transmission joint="light_head_pitch_joint"/>
     
    <!-- Light head base link -->
    <link
      name="${prefix}light_head_base_link">
      <inertial>
        <origin
          xyz="-0.041458 0.00047964 -0.0098049"
          rpy="0 0 0" />
        <mass
          value="0.15791" />
        <inertia
          ixx="0.00013618"
          ixy="3.0623E-08"
          ixz="-2.3023E-06"
          iyy="0.00010796"
          iyz="-4.366E-07"
          izz="0.0001748" />
      </inertial>
      <visual>
        <origin
          xyz="0 0 0"
          rpy="0 0 0" />
        <geometry>
          <mesh
            filename="package://bender_description/meshes/visual/light_head_base_link.stl" />
        </geometry>
        <material
          name="">
          <color
            rgba="0.6 0.6 0.6 1" />
        </material>
      </visual>
      <collision>
        <origin
          xyz="0 0 0"
          rpy="0 0 0" />
        <geometry>
          <mesh
            filename="package://bender_description/meshes/visual/light_head_base_link.stl" />
        </geometry>
      </collision>
    </link>
    <joint name="light_head_base_joint" type="fixed">
      <origin xyz="0 0 0" rpy="0 0 0" />
      <parent link="${parent}"/>
      <child link="${prefix}light_head_base_link" />
    </joint>

    <!-- Yaw link -->
    <link
      name="${prefix}light_head_yaw_link">
      <inertial>
        <origin
          xyz="-0.00066803 0.011643 -0.029059"
          rpy="0 0 0" />
        <mass
          value="0.099833" />
        <inertia
          ixx="7.3317E-05"
          ixy="-5.1E-07"
          ixz="2.2268E-07"
          iyy="6.5201E-05"
          iyz="-1.4131E-05"
          izz="8.9295E-05" />
      </inertial>
      <visual>
        <origin
          xyz="0 0 0"
          rpy="3.1415 0 0" /> 
        <geometry>
          <mesh
            filename="package://bender_description/meshes/visual/light_head_yaw_link.stl" />
        </geometry>
        <material
          name="">
          <color
            rgba="0.6 0.6 0.6 1" />
        </material>
      </visual>
      <collision>
        <origin
          xyz="0 0 0"
          rpy="0 0 0" />
        <geometry>
          <mesh
            filename="package://bender_description/meshes/visual/light_head_yaw_link.stl" />
        </geometry>
      </collision>
    </link>
    <joint
      name="light_head_yaw_joint"
      type="revolute">
      <origin
        xyz="-0.056 0 0"
        rpy="0 0 0" />
      <parent
        link="${prefix}light_head_base_link" />
      <child
        link="${prefix}light_head_yaw_link" />
      <axis
        xyz="0 0 1" />
      <!-- Limits based on Dynamixel motor encoder ticks -->
      <dynamics damping="0.1" />
      <limit effort="0.3" velocity="1.0" lower="-2.62" upper="2.62" />
      <dynamics damping="0.1" />
    </joint>

    <!-- Camera link with pitch movement -->
    <link
      name="${prefix}light_head_pitch_link">
      <inertial>
        <origin
          xyz="-0.0085671 0.0029816 0.056743"
          rpy="0 0 0" />
        <mass
          value="0.15438" />
        <inertia
          ixx="0.00042205"
          ixy="-2.5048E-06"
          ixz="-1.5995E-06"
          iyy="4.319E-05"
          iyz="7.1E-06"
          izz="0.00041533" />
      </inertial>
      <visual>
        <origin
          xyz="0 0 0"
          rpy="0 0 0" />
        <geometry>
          <mesh
            filename="package://bender_description/meshes/visual/light_head_pitch_link.stl" />
        </geometry>
        <material
          name="">
          <color
            rgba="0.1 0.1 0.1 1" />
        </material>
      </visual>
      <collision>
        <origin
          xyz="0 0 0"
          rpy="0 0 0" />
        <geometry>
          <mesh
            filename="package://bender_description/meshes/visual/light_head_pitch_link.stl" />
        </geometry>
      </collision>
    </link>
    <joint
      name="light_head_pitch_joint"
      type="revolute">
      <origin
        xyz="-0.001 -0.008 0.0525"
        rpy="0 0.35 0" />
      <parent
        link="${prefix}light_head_yaw_link" />
      <child
        link="${prefix}light_head_pitch_link" />
      <axis
        xyz="0 1 0" />
      <!-- Limits based on Dynamixel motor encoder ticks -->
      <limit effort="0.3" velocity="1.0" upper="1.166" lower="-1.0328" />
      <dynamics damping="0.1" />
    </joint>

    <!-- Camera RGB and depth frames -->
    <link
      name="${prefix}sensors/rgbd_head_rgb_frame" />
    <joint
      name="rgbd_head_rgb_joint"
      type="fixed">
      <origin
        xyz="-0.001116 0.02305 0.062283"
        rpy="0.0 -0.31716 0.0" />
      <parent
        link="${prefix}light_head_pitch_link" />
      <child
        link="${prefix}sensors/rgbd_head_rgb_frame" />
      <axis
        xyz="0 0 0" />
    </joint>
    <link
      name="${prefix}sensors/rgbd_head_depth_frame" />
    <joint
      name="rgbd_head_depth_joint"
      type="fixed">
      <origin
        xyz="-0.001116 0.04905 0.062283"
        rpy="0.0 -0.31716 0.0" />
      <parent
        link="${prefix}light_head_pitch_link" />
      <child
        link="${prefix}sensors/rgbd_head_depth_frame" />
      <axis
        xyz="0 0 0" />
    </joint>
    <!-- Optical frames -->
    <joint name="rgbd_head_rgb_optical_joint" type="fixed">
      <origin xyz="0 0 0" rpy="${-M_PI/2} 0 ${-M_PI/2}" />
      <parent link="${prefix}sensors/rgbd_head_rgb_frame" />
      <child link="${prefix}sensors/rgbd_head_rgb_optical_frame" />
    </joint>
    <link name="${prefix}sensors/rgbd_head_rgb_optical_frame"/>

    <joint name="rgbd_head_depth_optical_joint" type="fixed">
      <origin xyz="0 0 0" rpy="${-M_PI/2} 0 ${-M_PI/2}" />
      <parent link="${prefix}sensors/rgbd_head_depth_frame" />
      <child link="${prefix}sensors/rgbd_head_depth_optical_frame" />
    </joint>
    <link name="${prefix}sensors/rgbd_head_depth_optical_frame"/>

    <!-- Camera depth Gazebo -->
    <xacro:sim_depth_camera name="rgbd_head" frame="${prefix}sensors/rgbd_head_depth" ns="${ns}"/>

  </xacro:macro>
</robot>
